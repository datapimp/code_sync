// TODO actually recognize syntax of TypeScript constructs
CodeMirror.defineMode("javascript",function(e,t){function u(e,t,n){return t.tokenize=n,n(e,t)}function a(e,t){var n=!1,r;while((r=e.next())!=null){if(r==t&&!n)return!1;n=!n&&r=="\\"}return n}function c(e,t,n){return f=e,l=n,t}function h(e,t){var n=e.next();if(n=='"'||n=="'")return u(e,t,p(n));if(/[\[\]{}\(\),;\:\.]/.test(n))return c(n);if(n=="0"&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),c("number","number");if(/\d/.test(n)||n=="-"&&e.eat(/\d/))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),c("number","number");if(n=="/")return e.eat("*")?u(e,t,d):e.eat("/")?(e.skipToEnd(),c("comment","comment")):t.lastType=="operator"||t.lastType=="keyword c"||/^[\[{}\(,;:]$/.test(t.lastType)?(a(e,"/"),e.eatWhile(/[gimy]/),c("regexp","string-2")):(e.eatWhile(o),c("operator",null,e.current()));if(n=="#")return e.skipToEnd(),c("error","error");if(o.test(n))return e.eatWhile(o),c("operator",null,e.current());e.eatWhile(/[\w\$_]/);var r=e.current(),i=s.propertyIsEnumerable(r)&&s[r];return i&&t.lastType!="."?c(i.type,i.style,r):c("variable","variable",r)}function p(e){return function(t,n){return a(t,e)||(n.tokenize=h),c("string","string")}}function d(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=h;break}n=r=="*"}return c("comment","comment")}function m(e,t,n,r,i,s){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=s,r!=null&&(this.align=r)}function g(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0}function y(e,t,n,i,s){var o=e.cc;b.state=e,b.stream=s,b.marked=null,b.cc=o,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var u=o.length?o.pop():r?O:A;if(u(n,i)){while(o.length&&o[o.length-1].lex)o.pop()();return b.marked?b.marked:n=="variable"&&g(e,i)?"variable-2":t}}}function w(){for(var e=arguments.length-1;e>=0;e--)b.cc.push(arguments[e])}function E(){return w.apply(null,arguments),!0}function S(e){function t(t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}var n=b.state;if(n.context){b.marked="def";if(t(n.localVars))return;n.localVars={name:e,next:n.localVars}}else{if(t(n.globalVars))return;n.globalVars={name:e,next:n.globalVars}}}function T(){b.state.context={prev:b.state.context,vars:b.state.localVars},b.state.localVars=x}function N(){b.state.localVars=b.state.context.vars,b.state.context=b.state.context.prev}function C(e,t){var n=function(){var n=b.state;n.lexical=new m(n.indented,b.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function k(){var e=b.state;e.lexical.prev&&(e.lexical.type==")"&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function L(e){return function(t){return t==e?E():e==";"?w():E(arguments.callee)}}function A(e){return e=="var"?E(C("vardef"),W,L(";"),k):e=="keyword a"?E(C("form"),O,A,k):e=="keyword b"?E(C("form"),A,k):e=="{"?E(C("}"),R,k):e==";"?E():e=="if"?E(C("form"),O,A,k,V(b.state.indented)):e=="function"?E(G):e=="for"?E(C("form"),L("("),C(")"),$,L(")"),k,A,k):e=="variable"?E(C("stat"),B):e=="switch"?E(C("form"),O,C("}","switch"),L("{"),R,k,k):e=="case"?E(O,L(":")):e=="default"?E(L(":")):e=="catch"?E(C("form"),T,L("("),Y,L(")"),A,k,N):w(C("stat"),O,L(";"),k)}function O(e){return _(e,P)}function M(e){return _(e,H)}function _(e,t){return v.hasOwnProperty(e)?E(t):e=="function"?E(G):e=="keyword c"?E(D):e=="("?E(C(")"),D,L(")"),k,t):e=="operator"?E(O):e=="["?E(C("]"),q(M,"]"),k,t):e=="{"?E(C("}"),q(F,"}"),k,t):E()}function D(e){return e.match(/[;\}\)\],]/)?w():w(O)}function P(e,t){return e==","?w():H(e,t,P)}function H(e,t,n){n||(n=H);if(e=="operator")return/\+\+|--/.test(t)?E(n):t=="?"?E(O,L(":"),O):E(O);if(e==";")return;if(e=="(")return E(C(")","call"),q(M,")"),k,n);if(e==".")return E(j,n);if(e=="[")return E(C("]"),O,L("]"),k,n)}function B(e){return e==":"?E(k,A):w(P,L(";"),k)}function j(e){if(e=="variable")return b.marked="property",E()}function F(e,t){if(e=="variable"){b.marked="property";if(t=="get"||t=="set")return E(I)}else if(e=="number"||e=="string")b.marked=e+" property";if(v.hasOwnProperty(e))return E(L(":"),M)}function I(e){return e==":"?E(O):e!="variable"?E(L(":"),O):(b.marked="property",E(G))}function q(e,t){function n(r){if(r==","){var i=b.state.lexical;return i.info=="call"&&(i.pos=(i.pos||0)+1),E(e,n)}return r==t?E():E(L(t))}return function(r){return r==t?E():w(e,n)}}function R(e){return e=="}"?E():w(A,R)}function U(e){return e==":"?E(z):w()}function z(e){return e=="variable"?(b.marked="variable-3",E()):w()}function W(e,t){return e=="variable"?(S(t),i?E(U,X):E(X)):w()}function X(e,t){if(t=="=")return E(M,X);if(e==",")return E(W)}function V(e){return function(t,n){return t=="keyword b"&&n=="else"?(b.state.lexical=new m(e,0,"form",null,b.state.lexical),E(A,k)):w()}}function $(e){return e=="var"?E(W,L(";"),K):e==";"?E(K):e=="variable"?E(J):w(O,L(";"),K)}function J(e,t){return t=="in"?E(O):E(P,K)}function K(e,t){return e==";"?E(Q):t=="in"?E(O):w(O,L(";"),Q)}function Q(e){e!=")"&&E(O)}function G(e,t){if(e=="variable")return S(t),E(G);if(e=="(")return E(C(")"),T,q(Y,")"),k,A,N)}function Y(e,t){if(e=="variable")return S(t),i?E(U):E()}var n=e.indentUnit,r=t.json,i=t.typescript,s=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),s=e("operator"),o={type:"atom",style:"atom"},u={"if":e("if"),"while":t,"with":t,"else":n,"do":n,"try":n,"finally":n,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":s,"typeof":s,"instanceof":s,"true":o,"false":o,"null":o,"undefined":o,NaN:o,Infinity:o,"this":e("this")};if(i){var a={type:"variable",style:"variable-3"},f={"interface":e("interface"),"class":e("class"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),"super":e("super"),string:a,number:a,bool:a,any:a};for(var l in f)u[l]=f[l]}return u}(),o=/[+\-*&%=<>!?|~^]/,f,l,v={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0},b={state:null,column:null,marked:null,cc:null},x={name:"this",next:{name:"arguments"}};return k.lex=!0,{startState:function(e){return{tokenize:h,lastType:null,cc:[],lexical:new m((e||0)-n,0,"block",!1),localVars:t.localVars,globalVars:t.globalVars,context:t.localVars&&{vars:t.localVars},indented:0}},token:function(e,t){e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation());if(t.tokenize!=d&&e.eatSpace())return null;var n=t.tokenize(e,t);return f=="comment"?n:(t.lastType=f!="operator"||l!="++"&&l!="--"?f:"incdec",y(t,n,f,l,e))},indent:function(e,r){if(e.tokenize==d)return CodeMirror.Pass;if(e.tokenize!=h)return 0;var i=r&&r.charAt(0),s=e.lexical;s.type=="stat"&&i=="}"&&(s=s.prev);var o=s.type,u=i==o;if(t.statementIndent!=null){o==")"&&s.prev&&s.prev.type=="stat"&&(s=s.prev);if(s.type=="stat")return s.indented+t.statementIndent}return o=="vardef"?s.indented+(e.lastType=="operator"||e.lastType==","?4:0):o=="form"&&i=="{"?s.indented:o=="form"?s.indented+n:o=="stat"?s.indented+(e.lastType=="operator"||e.lastType==","?n:0):s.info=="switch"&&!u?s.indented+(/^(?:case|default)\b/.test(r)?n:2*n):s.align?s.column+(u?0:1):s.indented+(u?0:n)},electricChars:":{}",jsonMode:r}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("text/ecmascript","javascript"),CodeMirror.defineMIME("application/javascript","javascript"),CodeMirror.defineMIME("application/ecmascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0}),CodeMirror.defineMIME("application/x-json",{name:"javascript",json:!0}),CodeMirror.defineMIME("text/typescript",{name:"javascript",typescript:!0}),CodeMirror.defineMIME("application/typescript",{name:"javascript",typescript:!0});